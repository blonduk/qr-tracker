<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Glitch Link | Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/404_glitch.png') }}">
</head>
<body>
    <div class="glitch-title">Glitch Link</div>
    <h2 class="subtitle">QR Code Generator and Tracker</h2>

    <div class="center-wrap">
        <form method="POST" action="/add" class="add-form">
            <input type="text" name="short_id" placeholder="Short Code" required>
            <input type="url" name="destination" placeholder="Destination URL" required>
            <button type="submit">Add</button>
        </form>

        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>Short Code</th>
                        <th>Destination</th>
                        <th>Scans</th>
                        <th>QR</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sid, dest, count in stats %}
                        <tr>
                            <td>{{ sid }}</td>
                            <td><a href="{{ dest }}" target="_blank">{{ dest }}</a></td>
                            <td>{{ count }}</td>
                            <td><a href="{{ url_for('view_qr', short_id=sid) }}" target="_blank">
                                <img src="{{ url_for('view_qr', short_id=sid) }}" class="qr-thumb">
                            </a></td>
                            <td>
                                <form method="POST" action="/edit">
                                    <input type="hidden" name="short_id" value="{{ sid }}">
                                    <input type="url" name="new_destination" placeholder="New URL" required>
                                    <button type="submit">Edit</button>
                                </form>
                            </td>
                            <td>
                                <form method="POST" action="/delete/{{ sid }}" onsubmit="return confirm('Are you sure you want to delete this redirect?');">
                                    <button type="submit">Delete</button>
                                </form>
                            </td>
                        </tr>
                        <tr class="qr-buttons">
                            <td colspan="6">
                                <a href="/download-qr/{{ sid }}" class="qr-dl">Download PNG</a> |
                                <a href="/download-svg/{{ sid }}" class="qr-dl">Download SVG</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="buttons-row">
            <a href="/export-csv">Download Logs (CSV)</a>
            <a href="/logout">Logout</a>
        </div>
    </div>

    <footer>
        <p>&copy; {{ user }} | Glitch Link | {{ now.year }}</p>
    </footer>
</body>
</html>
