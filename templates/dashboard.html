<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Glitch Link Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/png" href="/static/images/404_glitch.png">
</head>
<body>
    <header>
        <h1 class="glitch" data-text="Glitch Link">Glitch Link</h1>
        <p class="subtitle">QR Code Generator and Tracker</p>
        <a href="/logout" class="logout-btn">Logout</a>
    </header>

    <main>
        <section class="dashboard">
            <h2>Welcome, {{ user }}</h2>

            <form action="/add" method="POST" class="add-form">
                <input type="text" name="short_id" placeholder="Short Code" required>
                <input type="text" name="destination" placeholder="Destination URL" required>
                <button type="submit">Add Link</button>
            </form>

            <table class="qr-table">
                <thead>
                    <tr>
                        <th>QR</th>
                        <th>Short Code</th>
                        <th>Destination</th>
                        <th>Scans</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sid, dest, count in stats %}
                    <tr>
                        <td><a href="/view-qr/{{ sid }}" target="_blank"><img src="/view-qr/{{ sid }}" alt="QR" class="qr-thumb"></a></td>
                        <td>{{ sid }}</td>
                        <td><a href="{{ dest }}" target="_blank">{{ dest }}</a></td>
                        <td>{{ count }}</td>
                        <td>
                            <form action="/edit" method="POST" class="inline-form">
                                <input type="hidden" name="short_id" value="{{ sid }}">
                                <input type="text" name="new_destination" placeholder="New URL">
                                <button type="submit" class="edit-btn">Edit</button>
                            </form>
                            <form action="/delete/{{ sid }}" method="POST" class="inline-form" onsubmit="return confirm('Are you sure you want to delete this code? This cannot be undone.')">
                                <button type="submit" class="delete-btn">Delete</button>
                            </form>
                            <a href="/download-qr/{{ sid }}" class="qr-download">PNG</a> |
                            <a href="/download-svg/{{ sid }}" class="qr-download">SVG</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="export">
                <a href="/export-csv" class="csv-link">Download Logs CSV</a>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; {{ user }} | Glitch Link | {{ now.strftime('%Y') }}</p>
    </footer>
</body>
</html>
